<section class="content-section">
    <div class="itinerary-container">
        <div class="itinerary-header">
            <h2>Your Personalized Jharkhand Itinerary</h2>
            <div id="trip-summary" class="trip-summary"></div>
        </div>

        <div class="content-grid">
            <div class="itinerary-content">
                <div id="itinerary-details" class="itinerary-details">
                    <!-- Itinerary will be loaded here -->
                </div>

                <div class="tips-section">
                    <h3>Travel Tips</h3>
                    <ul id="tips-list" class="tips-list"></ul>
                </div>

                <div class="carbon-section">
                    <h3>üåç Carbon Footprint & Sustainability</h3>
                    <div id="carbon-footprint" class="carbon-info"></div>
                    <div id="transport-section" class="transport-section">
                        <h4>üöå Recommended Transport Options</h4>
                        <div id="transport-options" class="transport-grid"></div>
                    </div>
                </div>

                <div class="button-group">
                    <button onclick="window.print()" class="print-button">Print Itinerary</button>
                    <button onclick="editTrip()" class="edit-button">Edit Trip</button>
                </div>
            </div>

            <div class="map-sidebar">
                <div class="map-container">
                    <h3>üìç Your Journey Map</h3>
                    <div id="map" style="width: 100%; height: 400px;"></div>
                    <div class="map-legend">
                        <div class="legend-item">
                            <span class="legend-marker" style="background: #ff4444;"></span>
                            <span>Starting Point</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-marker" style="background: #4444ff;"></span>
                            <span>Attractions</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-marker" style="background: purple;"></span>
                            <span>End Point</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<style>
* {
  box-sizing: border-box;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

:root {
  --primary: #107869;
  --primary-light: #5cd85a;
  --primary-dark: #1a5653;
  --accent: #4caf50;
  --text: #1a1a1a;
  --text-light: #666;
  --border: #e0f0ed;
  --bg-light: #f8fffe;
  --shadow-sm: 0 2px 8px rgba(16, 120, 105, 0.08);
  --shadow-md: 0 8px 24px rgba(16, 120, 105, 0.12);
  --shadow-lg: 0 20px 60px rgba(16, 120, 105, 0.25);
  --shadow-xl: 0 30px 80px rgba(16, 120, 105, 0.3);
}

.content-section {
  max-width: 1400px;
  margin: 0 auto;
  padding: 60px 20px;
  background: linear-gradient(135deg, #ffffff 0%, #f8fffe 50%, #f0faf8 100%);
  min-height: 100vh;
}

.itinerary-container {
  max-width: 1400px;
  margin: 0 auto;
}

.itinerary-header {
  background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 50%, #0f4a3f 100%);
  color: white;
  padding: 80px 50px;
  border-radius: 24px;
  margin-bottom: 60px;
  text-align: center;
  box-shadow: var(--shadow-xl);
  position: relative;
  overflow: hidden;
  backdrop-filter: blur(10px);
}

.itinerary-header::before {
  content: '';
  position: absolute;
  top: -50%;
  right: -10%;
  width: 400px;
  height: 400px;
  background: radial-gradient(circle, rgba(255, 255, 255, 0.15) 0%, transparent 70%);
  border-radius: 50%;
  animation: float 6s ease-in-out infinite;
}

.itinerary-header::after {
  content: '';
  position: absolute;
  bottom: -40%;
  left: -5%;
  width: 350px;
  height: 350px;
  background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
  border-radius: 50%;
  animation: float 8s ease-in-out infinite 1s;
}

.itinerary-header h2 {
  margin: 0 0 40px 0;
  font-size: 56px;
  font-weight: 900;
  letter-spacing: -2px;
  position: relative;
  z-index: 2;
  text-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
  line-height: 1.2;
  background: linear-gradient(135deg, #ffffff 0%, #e8f5f0 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.trip-summary {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(170px, 1fr));
  gap: 25px;
  margin-top: 40px;
  position: relative;
  z-index: 3;
}

.summary-item {
  background: linear-gradient(135deg, rgba(255, 255, 255, 0.16) 0%, rgba(255, 255, 255, 0.08) 100%);
  padding: 28px 24px;
  border-radius: 16px;
  text-align: center;
  backdrop-filter: blur(30px);
  border: 2px solid rgba(255, 255, 255, 0.3);
  transition: all 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
}

.summary-item:hover {
  background: linear-gradient(135deg, rgba(255, 255, 255, 0.25) 0%, rgba(255, 255, 255, 0.15) 100%);
  transform: translateY(-8px);
  border-color: rgba(255, 255, 255, 0.5);
  box-shadow: 0 20px 50px rgba(0, 0, 0, 0.15);
}

.summary-item-label {
  font-size: 11px;
  opacity: 0.9;
  margin-bottom: 10px;
  text-transform: uppercase;
  letter-spacing: 1.5px;
  font-weight: 700;
}

.summary-item-value {
  font-size: 32px;
  font-weight: 900;
  letter-spacing: -0.5px;
  line-height: 1.2;
}

.content-grid {
  display: grid;
  grid-template-columns: 1fr 400px;
  gap: 35px;
  margin-bottom: 50px;
}

.itinerary-content {
  background: linear-gradient(135deg, #ffffff 0%, #f9fffe 100%);
  border: 2px solid var(--border);
  border-radius: 22px;
  padding: 50px;
  box-shadow: var(--shadow-md);
  transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
}

.itinerary-details {
  margin-bottom: 45px;
}

.day-section {
  margin-bottom: 32px;
  padding: 35px;
  background: linear-gradient(135deg, #fafffe 0%, #f5fcfb 50%, #f0faf8 100%);
  border-radius: 18px;
  border-left: 7px solid var(--primary);
  transition: all 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  box-shadow: var(--shadow-sm);
  position: relative;
  overflow: hidden;
}

.day-section::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 3px;
  background: linear-gradient(90deg, var(--primary) 0%, var(--accent) 50%, transparent 100%);
  opacity: 0;
  transition: opacity 0.4s ease;
}

.day-section:hover {
  box-shadow: var(--shadow-md);
  transform: translateX(8px);
  background: linear-gradient(135deg, #f5fcfb 0%, #f0faf8 50%, #e8f7f4 100%);
  border-left-color: var(--accent);
}

.day-section:hover::before {
  opacity: 1;
}

.day-section h4 {
  color: var(--primary);
  margin: 0 0 24px 0;
  font-size: 24px;
  font-weight: 800;
  display: flex;
  align-items: center;
  gap: 14px;
  letter-spacing: -0.5px;
}

.day-section h4:before {
  content: "üìÖ";
  font-size: 28px;
  display: inline-block;
  animation: bounce 2.5s cubic-bezier(0.68, -0.55, 0.265, 1.55) infinite;
}

@keyframes bounce {
  0%, 100% { transform: translateY(0) scaleX(1); }
  50% { transform: translateY(-6px) scaleX(1.05); }
}

.day-section ul {
  list-style: none;
  padding: 0;
  margin: 0;
}

.day-section li {
  padding: 16px 0;
  padding-left: 36px;
  position: relative;
  color: var(--text);
  font-size: 15px;
  line-height: 1.8;
  transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  font-weight: 600;
}

.day-section li:hover {
  color: var(--primary);
  padding-left: 42px;
  transform: translateX(4px);
}

.day-section li:before {
  content: "‚ú¶";
  position: absolute;
  left: 0;
  color: var(--primary);
  font-weight: 900;
  font-size: 18px;
  transition: all 0.3s ease;
}

.tips-section {
  background: linear-gradient(135deg, #f5fffe 0%, #f0faf8 50%, #eaf7f4 100%);
  padding: 35px;
  border-radius: 18px;
  border-left: 7px solid var(--primary);
  margin-bottom: 40px;
  box-shadow: var(--shadow-sm);
  transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
}

.tips-section:hover {
  box-shadow: var(--shadow-md);
  transform: translateX(4px);
}

.tips-section h3 {
  color: var(--primary);
  margin: 0 0 24px 0;
  font-size: 22px;
  font-weight: 800;
  display: flex;
  align-items: center;
  gap: 14px;
  letter-spacing: -0.3px;
}

.tips-section h3:before {
  content: "üí°";
  font-size: 26px;
  animation: float 3s ease-in-out infinite;
}

@keyframes float {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-8px); }
}

.tips-list {
  list-style: none;
  padding: 0;
  margin: 0;
}

.tips-list li {
  padding: 16px 0;
  padding-left: 36px;
  position: relative;
  color: var(--text);
  font-size: 15px;
  line-height: 1.8;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
}

.tips-list li:hover {
  color: var(--primary);
  padding-left: 42px;
  transform: translateX(4px);
}

.tips-list li:before {
  content: "‚úì";
  position: absolute;
  left: 0;
  color: var(--primary);
  font-weight: 900;
  font-size: 20px;
  transition: all 0.3s ease;
}

.carbon-section {
  background: linear-gradient(135deg, #f0f8e8 0%, #e8f5e9 50%, #e0f2f1 100%);
  padding: 35px;
  border-radius: 18px;
  border-left: 7px solid var(--accent);
  margin-bottom: 40px;
  box-shadow: 0 8px 25px rgba(76, 175, 80, 0.12);
  transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
}

.carbon-section:hover {
  box-shadow: 0 12px 40px rgba(76, 175, 80, 0.18);
  transform: translateX(4px);
}

.carbon-section h3 {
  color: #2e7d32;
  margin: 0 0 26px 0;
  font-size: 22px;
  font-weight: 800;
  display: flex;
  align-items: center;
  gap: 14px;
  letter-spacing: -0.3px;
}

.carbon-info {
  background: linear-gradient(135deg, #fafdf8 0%, #f5fcf5 100%);
  padding: 28px;
  border-radius: 14px;
  margin-bottom: 24px;
  border: 2px solid #c8e6c9;
  box-shadow: 0 4px 15px rgba(46, 125, 50, 0.06);
  transition: all 0.3s ease;
}

.carbon-metric {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 16px 0;
  border-bottom: 1px solid #e8f5e9;
  transition: all 0.3s ease;
}

.carbon-metric:hover {
  padding-left: 4px;
}

.carbon-metric:last-child {
  border-bottom: none;
}

.carbon-metric-label {
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.carbon-metric-label strong {
  color: #2e7d32;
  font-size: 15px;
  font-weight: 700;
}

.carbon-metric-label small {
  color: var(--text-light);
  font-size: 13px;
}

.carbon-metric-value {
  text-align: right;
}

.carbon-metric-value .value {
  font-size: 20px;
  font-weight: 800;
  color: #2e7d32;
  letter-spacing: -0.5px;
}

.carbon-metric-value .unit {
  font-size: 12px;
  color: var(--text-light);
  font-weight: 600;
}

.carbon-footer {
  background: linear-gradient(135deg, #fff8e1 0%, #ffecb3 100%);
  padding: 18px 20px;
  border-radius: 12px;
  font-size: 15px;
  color: #e65100;
  margin-top: 22px;
  border-left: 5px solid #ff9800;
  font-weight: 700;
  line-height: 1.8;
  box-shadow: 0 4px 15px rgba(255, 152, 0, 0.15);
  transition: all 0.3s ease;
}

.carbon-footer:hover {
  box-shadow: 0 8px 25px rgba(255, 152, 0, 0.25);
  transform: translateX(2px);
}

.transport-section {
  margin-top: 28px;
}

.transport-section h4 {
  color: #2e7d32;
  margin: 0 0 24px 0;
  font-size: 20px;
  font-weight: 800;
  display: flex;
  align-items: center;
  gap: 12px;
  letter-spacing: -0.3px;
}

.transport-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
  gap: 22px;
}

.transport-card {
  background: linear-gradient(135deg, #ffffff 0%, #f9fdf8 100%);
  padding: 26px;
  border-radius: 16px;
  border: 2.5px solid #c8e6c9;
  transition: all 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  cursor: pointer;
  border-left: 7px solid var(--accent);
  box-shadow: 0 8px 22px rgba(76, 175, 80, 0.1);
  position: relative;
  overflow: hidden;
}

.transport-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(76, 175, 80, 0.2), transparent);
  transition: left 0.7s cubic-bezier(0.25, 0.46, 0.45, 0.94);
}

.transport-card:hover {
  box-shadow: 0 16px 45px rgba(76, 175, 80, 0.25);
  transform: translateY(-10px);
  border-left: 7px solid #2e7d32;
  border-color: var(--accent);
}

.transport-card:hover::before {
  left: 100%;
}

.transport-card.selected {
  background: linear-gradient(135deg, #e8f5e9 0%, #f1f8e9 100%);
  border: 2.5px solid var(--accent);
  box-shadow: 0 14px 40px rgba(76, 175, 80, 0.3);
  border-left: 7px solid #2e7d32;
}

.transport-card-icon {
  font-size: 42px;
  margin-bottom: 16px;
  display: inline-block;
  animation: shimmerFloat 3.5s cubic-bezier(0.68, -0.55, 0.265, 1.55) infinite;
}

.transport-card:hover .transport-card-icon {
  animation-duration: 2.5s;
}

@keyframes shimmerFloat {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-8px); }
}

.transport-card-name {
  font-weight: 850;
  color: #2e7d32;
  font-size: 17px;
  margin-bottom: 14px;
  letter-spacing: -0.3px;
}

.transport-card-co2 {
  font-size: 13px;
  color: var(--text-light);
  margin-bottom: 8px;
  font-weight: 500;
}

.transport-card-co2 strong {
  color: #2e7d32;
  font-size: 14px;
  font-weight: 700;
}

.transport-card-savings {
  font-size: 12px;
  background: #e8f5e9;
  padding: 8px 10px;
  border-radius: 8px;
  color: #2e7d32;
  font-weight: 700;
  margin-top: 10px;
  text-align: center;
  border: 1px solid #c8e6c9;
}

.sustainability-badge {
  display: inline-block;
  background: linear-gradient(135deg, var(--accent) 0%, #2e7d32 100%);
  color: white;
  padding: 10px 14px;
  border-radius: 25px;
  font-size: 12px;
  font-weight: 700;
  margin-top: 12px;
  box-shadow: 0 4px 12px rgba(76, 175, 80, 0.25);
  letter-spacing: 0.5px;
}

.button-group {
  display: flex;
  gap: 20px;
  margin-top: 50px;
  padding-top: 40px;
  border-top: 3px solid var(--border);
}

.print-button,
.edit-button {
  flex: 1;
  padding: 18px 32px;
  border: none;
  border-radius: 14px;
  font-size: 16px;
  font-weight: 800;
  cursor: pointer;
  text-decoration: none;
  text-align: center;
  transition: all 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  letter-spacing: 0.8px;
  text-transform: uppercase;
  box-shadow: var(--shadow-lg);
  position: relative;
  overflow: hidden;
}

.print-button::before,
.edit-button::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
  transition: left 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94);
}

.print-button:hover::before,
.edit-button:hover::before {
  left: 100%;
}

.print-button {
  background: linear-gradient(135deg, var(--primary) 0%, #005a48 50%, var(--primary-dark) 100%);
  color: white;
  box-shadow: 0 8px 25px rgba(16, 120, 105, 0.3);
}

.print-button:hover {
  transform: translateY(-6px);
  box-shadow: 0 15px 50px rgba(16, 120, 105, 0.45);
}

.edit-button {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #5a3d9f 100%);
  color: white;
  box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
}

.edit-button:hover {
  transform: translateY(-6px);
  box-shadow: 0 15px 50px rgba(102, 126, 234, 0.45);
}

.map-sidebar {
  padding: 35px;
  background: linear-gradient(135deg, #ffffff 0%, #f8fffe 100%);
  border-radius: 22px;
  border: 2px solid var(--border);
  height: fit-content;
  position: sticky;
  top: 30px;
  box-shadow: var(--shadow-md);
  transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
}

.map-sidebar:hover {
  box-shadow: var(--shadow-lg);
  transform: translateY(-2px);
}

.map-container {
  display: flex;
  flex-direction: column;
  gap: 22px;
}

.map-container h3 {
  color: var(--primary);
  margin: 0;
  font-size: 21px;
  font-weight: 800;
  display: flex;
  align-items: center;
  gap: 12px;
  letter-spacing: -0.3px;
}

#map {
  width: 100%;
  height: 500px;
  border-radius: 18px;
  border: 2px solid var(--border);
  box-shadow: 0 10px 35px rgba(16, 120, 105, 0.12);
  background: #f0f0f0;
  transition: all 0.4s ease;
}

#map:hover {
  box-shadow: 0 15px 50px rgba(16, 120, 105, 0.18);
}

.map-legend {
  display: flex;
  flex-direction: column;
  gap: 14px;
  padding: 20px;
  background: linear-gradient(135deg, #fafffe 0%, #f5fcfb 100%);
  border-radius: 14px;
  border: 2px solid var(--border);
  box-shadow: 0 4px 15px rgba(16, 120, 105, 0.06);
  transition: all 0.3s ease;
}

.map-legend:hover {
  box-shadow: 0 8px 25px rgba(16, 120, 105, 0.12);
}

.legend-item {
  display: flex;
  align-items: center;
  gap: 16px;
  font-size: 15px;
  color: var(--text);
  font-weight: 700;
  transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  padding: 8px 10px;
  border-radius: 8px;
}

.legend-item:hover {
  transform: translateX(6px);
  background: rgba(16, 120, 105, 0.04);
}

.legend-marker {
  width: 18px;
  height: 18px;
  border-radius: 50%;
  border: 2.5px solid white;
  box-shadow: 0 3px 12px rgba(0, 0, 0, 0.25);
  flex-shrink: 0;
  transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
}

@media print {
  .button-group {
    display: none;
  }
  
  .map-sidebar {
    display: none;
  }
}

@media (max-width: 1024px) {
  .content-grid {
    grid-template-columns: 1fr;
  }
  
  .map-sidebar {
    position: relative;
    top: 0;
  }
}

@media (max-width: 768px) {
  .content-section {
    padding: 30px 15px;
  }

  .itinerary-header {
    padding: 40px 25px;
  }

  .itinerary-header h2 {
    font-size: 32px;
  }

  .itinerary-content {
    padding: 25px;
  }

  .button-group {
    flex-direction: column;
    gap: 12px;
  }

  .trip-summary {
    grid-template-columns: repeat(2, 1fr);
  }

  .day-section {
    padding: 20px;
  }

  #map {
    height: 350px;
  }

  .transport-grid {
    grid-template-columns: 1fr;
  }
}
</style>

<script async defer src="https://maps.googleapis.com/maps/api/js?key=<%= process.env.GOOGLE_MAPS_API_KEY %>"></script>

<script>
    const activities = {
        'Ranchi': {
            nature: ['Jamshedpur Steel City Tour', 'Tagore Hill Visit', 'Lake Picnic', 'Forest Trek', 'Botanical Garden'],
            adventure: ['Rock Climbing at Hundru Falls', 'Trekking', 'Paragliding', 'Mountain Biking'],
            culture: ['Jain Temple Visit', 'Tribal Art Gallery', 'Local Museums', 'Traditional Markets'],
            spiritual: ['Ancient Temple Complex', 'Meditation Retreat', 'Ashram Visit'],
            photography: ['Sunrise at Tagore Hill', 'Waterfall Photography', 'Street Photography'],
            food: ['Local Dhabas', 'Street Food Tour', 'Traditional Cooking Class']
        },
        'Deoghar': {
            nature: ['Basukinath Temple Trek', 'Sacred Sthal Waterfall', 'Nature Walk', 'Bird Watching'],
            adventure: ['Hill Trekking', 'Waterfall Trek', 'River Crossing'],
            culture: ['Ancient Temple Complex', 'Religious Site Tour', 'Local Crafts'],
            spiritual: ['Pilgrimage Tour', 'Meditation Spots', 'Sacred Springs'],
            photography: ['Waterfall Photography', 'Temple Architecture', 'Landscape'],
            food: ['Temple Prasad', 'Local Cuisine', 'River-side Dining']
        },
        'Hazaribagh': {
            nature: ['Lake Boating', 'Wildlife Sanctuary', 'Bird Watching', 'Nature Trail'],
            adventure: ['Trekking', 'Water Sports', 'Camping', 'Fishing'],
            culture: ['Local Crafts Market', 'Traditional Markets', 'Village Tour'],
            spiritual: ['Temple Visits', 'Ashram Retreat', 'Meditation'],
            photography: ['Lake Photography', 'Wildlife Shots', 'Sunset Views'],
            food: ['Local Fish Dishes', 'Traditional Meals', 'Street Food']
        },
        'Jamshedpur': {
            nature: ['Dalma Wildlife Sanctuary', 'Garden Tours', 'Lake Visits'],
            adventure: ['Rock Climbing', 'Trekking', 'Water Sports'],
            culture: ['Steel Museum', 'Art Gallery', 'Cultural Shows'],
            spiritual: ['Temple Tours', 'Meditation'],
            photography: ['Industrial Heritage', 'Nature Shots', 'City Landscape'],
            food: ['Multi-cuisine Restaurants', 'Local Cuisine', 'Street Food']
        },
        'Dhanbad': {
            nature: ['Lake Tours', 'Green Parks', 'Nature Reserve'],
            adventure: ['Water Sports', 'Adventure Parks', 'Trekking'],
            culture: ['Coal Mining Museum', 'Art Gallery', 'Historical Sites'],
            spiritual: ['Temple Visits', 'Meditation Spots'],
            photography: ['Industrial Photography', 'Lake Views', 'Sunset'],
            food: ['Local Restaurants', 'Street Food', 'Traditional Cuisine']
        },
        'Betla National Park': {
            nature: ['Tiger Safari', 'Bird Watching', 'Forest Trek', 'Wildlife Tour'],
            adventure: ['Jungle Trekking', 'Camping'],
            photography: ['Wildlife Photography', 'Nature Shots'],
            culture: ['Tribal Village Tour'],
            food: ['Camp Meals', 'Local Cuisine']
        },
        'Netarhat': {
            nature: ['Hill Station Views', 'Trekking', 'Waterfall Visit'],
            adventure: ['Mountain Biking', 'Trekking', 'Rock Climbing'],
            photography: ['Sunrise Photography', 'Landscape', 'Waterfall'],
            food: ['Local Cuisine', 'Hill Station Dining']
        },
        'Parasnath': {
            nature: ['Hill Trek', 'Nature Walk', 'Scenic Views'],
            adventure: ['Temple Trek', 'Rock Climbing'],
            spiritual: ['Jain Temple Visit', 'Pilgrimage', 'Meditation'],
            culture: ['Sacred Sites', 'Village Tour'],
            food: ['Local Cuisine', 'Temple Food']
        }
    };

    const budgetTips = {
        budget: 'Stay in budget hotels, use local transport, eat at local restaurants',
        moderate: 'Stay in mid-range hotels, mix of transport, enjoy some attractions',
        comfort: 'Stay in good hotels, comfortable transport, enjoy dining',
        luxury: 'Stay in premium hotels, private transport, fine dining'
    };

    const transportOptions = [
        { id: 'flight', name: 'Flight', icon: '‚úàÔ∏è', co2PerKm: 0.255, costPerKm: 2.5 },
        { id: 'car', name: 'Private Car', icon: 'üöó', co2PerKm: 0.192, costPerKm: 1.8 },
        { id: 'bus', name: 'Bus', icon: 'üöå', co2PerKm: 0.089, costPerKm: 0.6 },
        { id: 'train', name: 'Train', icon: 'üöÇ', co2PerKm: 0.041, costPerKm: 0.8 },
        { id: 'bicycle', name: 'Bicycle', icon: 'üö¥', co2PerKm: 0, costPerKm: 0 },
        { id: 'walking', name: 'Walking', icon: 'üö∂', co2PerKm: 0, costPerKm: 0 }
    ];

    const distanceMatrix = {
        'Ranchi': 0, 'Deoghar': 240, 'Hazaribagh': 130, 'Jamshedpur': 140,
        'Dhanbad': 180, 'Betla National Park': 200, 'Netarhat': 110, 'Parasnath': 220
    };

    const destinationCoords = {
        'Ranchi': { lat: 23.3441, lng: 85.3096 },
        'Deoghar': { lat: 24.5000, lng: 86.6906 },
        'Hazaribagh': { lat: 24.0175, lng: 85.4065 },
        'Jamshedpur': { lat: 22.8000, lng: 86.1855 },
        'Dhanbad': { lat: 23.7957, lng: 86.4304 },
        'Betla National Park': { lat: 24.5089, lng: 84.5339 },
        'Netarhat': { lat: 23.4665, lng: 84.3342 },
        'Parasnath': { lat: 24.8000, lng: 86.0500 }
    };

    let map = null;
    let markers = [];

    function initMap() {
        if (!window.tripData) {
            console.log('Trip data not available');
            return;
        }

        const destination = window.tripData.destination;
        const coords = destinationCoords[destination] || destinationCoords['Ranchi'];
        const mapElement = document.getElementById('map');
        if (!mapElement) return;
        
        map = new google.maps.Map(mapElement, {
            zoom: 12,
            center: coords,
            mapTypeControl: true,
            zoomControl: true,
            streetViewControl: false,
            fullscreenControl: true,
            styles: [{ featureType: "all", stylers: [{ lightness: 0.2 }] }]
        });

        addMarker(coords, 'Starting Point - ' + destination, '#ff4444', 'http://maps.google.com/mapfiles/ms/icons/red-dot.png');
        
        const attractions = [
            { name: 'Main Attraction', offset: { lat: 0.02, lng: 0.02 } },
            { name: 'Secondary Attraction', offset: { lat: -0.02, lng: 0.02 } }
        ];
        
        attractions.forEach(attraction => {
            const markerCoord = {
                lat: coords.lat + attraction.offset.lat,
                lng: coords.lng + attraction.offset.lng
            };
            addMarker(markerCoord, attraction.name, '#4444ff', 'http://maps.google.com/mapfiles/ms/icons/blue-dot.png');
        });

        const endCoord = { lat: coords.lat - 0.03, lng: coords.lng - 0.03 };
        addMarker(endCoord, 'End Point - ' + destination, 'purple', 'http://maps.google.com/mapfiles/ms/icons/purple-dot.png');

        drawRoute([coords, attractions[0].offset, attractions[1].offset, endCoord].map((point, idx) => {
            if (idx === 0) return coords;
            return { lat: coords.lat + point.lat, lng: coords.lng + point.lng };
        }));

        google.maps.event.trigger(map, 'resize');
    }

    function addMarker(position, title, color, icon) {
        const marker = new google.maps.Marker({ position, map, title, icon });
        const infoWindow = new google.maps.InfoWindow({ content: `<div style="padding: 8px; font-size: 13px;"><strong>${title}</strong></div>` });

        marker.addListener('click', function() {
            markers.forEach(m => { if (m.infoWindow) m.infoWindow.close(); });
            infoWindow.open(map, marker);
        });

        marker.infoWindow = infoWindow;
        markers.push(marker);
    }

    function drawRoute(points) {
        new google.maps.Polyline({
            path: points,
            geodesic: true,
            strokeColor: '#107869',
            strokeOpacity: 0.7,
            strokeWeight: 3,
            map: map
        });
    }

    function calculateCarbonFootprint() {
        if (!window.tripData) return null;
        
        const destination = window.tripData.destination;
        const duration = parseInt(window.tripData.duration) || 1;
        const people = parseInt(window.tripData.people) || 1;
        const distance = distanceMatrix[destination] || 150;
        
        const emissions = {};
        let minEmissions = Infinity;
        let bestOption = 'bus';
        
        transportOptions.forEach(option => {
            const totalEmissions = option.co2PerKm * distance * (option.id === 'flight' ? 1 : 2);
            const perPersonEmissions = totalEmissions / people;
            emissions[option.id] = { total: totalEmissions, perPerson: perPersonEmissions, option: option };
            
            if (perPersonEmissions < minEmissions && option.id !== 'flight') {
                minEmissions = perPersonEmissions;
                bestOption = option.id;
            }
        });
        
        return { distance, emissions, bestOption, duration, people };
    }

    function displayCarbonFootprint() {
        const carbonSection = document.getElementById('carbon-footprint');
        if (!carbonSection) return;
        
        const footprint = calculateCarbonFootprint();
        if (!footprint) return;
        
        const flightEmission = footprint.emissions['flight'].perPerson;
        const bestEmission = footprint.emissions[footprint.bestOption].perPerson;
        const savings = flightEmission - bestEmission;
        const savingsPercent = ((savings / flightEmission) * 100).toFixed(1);
        
        carbonSection.innerHTML = `
            <div class="carbon-metric">
                <div class="carbon-metric-label"><strong>Distance to Destination</strong><small>Round trip estimation</small></div>
                <div class="carbon-metric-value"><div class="value">${(footprint.distance * 2).toFixed(0)}</div><div class="unit">km</div></div>
            </div>
            <div class="carbon-metric">
                <div class="carbon-metric-label"><strong>Trip Duration</strong><small>Number of days</small></div>
                <div class="carbon-metric-value"><div class="value">${footprint.duration}</div><div class="unit">days</div></div>
            </div>
            <div class="carbon-metric">
                <div class="carbon-metric-label"><strong>Travelers</strong><small>Number of people</small></div>
                <div class="carbon-metric-value"><div class="value">${footprint.people}</div><div class="unit">persons</div></div>
            </div>
            <div class="carbon-metric">
                <div class="carbon-metric-label"><strong>Best Option CO‚ÇÇ Emissions</strong><small>Per person (${footprint.emissions[footprint.bestOption].option.name})</small></div>
                <div class="carbon-metric-value"><div class="value">${bestEmission.toFixed(2)}</div><div class="unit">kg CO‚ÇÇ</div></div>
            </div>
            <div class="carbon-metric">
                <div class="carbon-metric-label"><strong>Potential Savings vs Flight</strong><small>By choosing eco-friendly option</small></div>
                <div class="carbon-metric-value"><div class="value" style="color: #4caf50;">${savings.toFixed(2)}</div><div class="unit">${savingsPercent}% less</div></div>
            </div>
            <div class="carbon-footer">‚ÑπÔ∏è Choosing ${footprint.emissions[footprint.bestOption].option.name.toLowerCase()} over flight saves approximately <strong>${savings.toFixed(2)} kg CO‚ÇÇ per person</strong>. This is equivalent to planting <strong>${(savings / 21).toFixed(1)} trees</strong>!</div>
        `;
    }

    function displayTransportOptions() {
        const transportDiv = document.getElementById('transport-options');
        if (!transportDiv) return;
        
        const footprint = calculateCarbonFootprint();
        if (!footprint) return;
        
        const bestOption = footprint.bestOption;
        
        transportDiv.innerHTML = transportOptions.map(option => {
            const emission = footprint.emissions[option.id];
            const perPersonCo2 = emission.perPerson.toFixed(2);
            const cost = (option.costPerKm * footprint.distance * 2 / footprint.people).toFixed(2);
            const isSelected = option.id === bestOption;
            const badge = isSelected ? '<span class="sustainability-badge">‚úì RECOMMENDED</span>' : '';
            
            return `
                <div class="transport-card ${isSelected ? 'selected' : ''}">
                    <div class="transport-card-icon">${option.icon}</div>
                    <div class="transport-card-name">${option.name}</div>
                    <div class="transport-card-co2"><strong>${perPersonCo2}</strong> kg CO‚ÇÇ</div>
                    <div style="font-size: 12px; color: #666;">‚Çπ ${cost}</div>
                    ${badge}
                </div>
            `;
        }).join('');
    }

    function displaySummary() {
        const summary = document.getElementById('trip-summary');
        if (!summary || !window.tripData) return;
        
        summary.innerHTML = `
            <div class="summary-item">
                <div class="summary-item-label">Destination</div>
                <div class="summary-item-value">${window.tripData.destination || 'N/A'}</div>
            </div>
            <div class="summary-item">
                <div class="summary-item-label">Duration</div>
                <div class="summary-item-value">${window.tripData.duration || 'N/A'} Days</div>
            </div>
            <div class="summary-item">
                <div class="summary-item-label">Travelers</div>
                <div class="summary-item-value">${window.tripData.people || 'N/A'} People</div>
            </div>
            <div class="summary-item">
                <div class="summary-item-label">Budget</div>
                <div class="summary-item-value">${window.tripData.budget || 'N/A'}</div>
            </div>
        `;
    }

    function generateItinerary() {
        if (!window.tripData) return;
        
        const destination = window.tripData.destination;
        const duration = parseInt(window.tripData.duration) || 3;
        const interestsString = window.tripData.interests || '';
        const interests = interestsString ? interestsString.split(',').map(i => i.trim()) : ['nature'];
        
        const destinationActivities = activities[destination] || activities['Ranchi'];
        let allActivities = [];
        
        interests.forEach(interest => {
            if (destinationActivities[interest]) {
                allActivities = allActivities.concat(destinationActivities[interest]);
            }
        });

        if (allActivities.length === 0) {
            allActivities = Object.values(destinationActivities).flat();
        }

        const itineraryDiv = document.getElementById('itinerary-details');
        if (!itineraryDiv) return;
        
        itineraryDiv.innerHTML = '';
        const activitiesPerDay = Math.max(1, Math.ceil(allActivities.length / duration));
        let activityIndex = 0;

        for (let day = 1; day <= duration; day++) {
            const dayDiv = document.createElement('div');
            dayDiv.className = 'day-section';
            
            let dayContent = `<h4>Day ${day}: ${destination}</h4><ul>`;
            
            for (let i = 0; i < activitiesPerDay && activityIndex < allActivities.length; i++) {
                dayContent += `<li>${allActivities[activityIndex++]}</li>`;
            }
            
            dayContent += `<li>${day < duration ? 'Rest and prepare for next day' : 'Departure preparation'}</li></ul>`;
            dayDiv.innerHTML = dayContent;
            itineraryDiv.appendChild(dayDiv);
        }

        const tipsList = document.getElementById('tips-list');
        if (tipsList) {
            tipsList.innerHTML = `
                <li>${budgetTips[window.tripData.budget] || budgetTips.moderate}</li>
                <li>Best time to visit: October to March</li>
                <li>Pack comfortable walking shoes and weather-appropriate clothing</li>
                <li>Try local cuisine and handicrafts</li>
                <li>Book accommodations in advance during peak season</li>
                <li>Carry necessary medications and first aid kit</li>
                <li>Keep your phone charged and carry a power bank</li>
            `;
        }
    }

    function editTrip() {
        localStorage.clear();
        window.location.href = '/plantrip/trip-Planner';
    }

    function loadItinerary() {
        const tripData = localStorage.getItem('tripPlan');
        if (tripData) {
            window.tripData = JSON.parse(tripData);
            displaySummary();
            generateItinerary();
            displayCarbonFootprint();
            displayTransportOptions();
            
            window.addEventListener('load', function() {
                if (window.google && window.google.maps) {
                    setTimeout(initMap, 500);
                }
            });
        }
    }

    loadItinerary();
</script>
